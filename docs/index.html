<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAE Feature Analysis</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        /* Feature info 2x2 grid styling */
        .feature-info {
            margin-bottom: 1rem;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            gap: 1rem;
        }
        
        .info-left {
            flex: 0 0 auto;
        }
        
        .info-right {
            flex: 1;
            text-align: right;
            font-size: 0.75rem;
            font-family: monospace;
            color: #6c757d;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .config-label {
            font-weight: bold;
            color: #6f42c1;
            margin-right: 0.5rem;
        }
        
        /* Ensure feature select and activation text are same size */
        .feature-title-select {
            font-size: 1rem;
            font-weight: bold;
        }
        
        .info-left p {
            margin: 0;
            font-size: 1rem;
        }
        
        /* Make feature viewer container relative for absolute positioning */
        .feature-viewer {
            position: relative;
        }
        
        /* Section navigation styling */
        .section-nav {
            background-color: transparent;
            padding: 0.5rem 0;
            margin: 0 0 1rem 0;
            font-size: 0.9rem;
        }
        
        .section-nav a {
            color: #6f42c1;
            text-decoration: none;
            font-size: 1.2rem;
        }
        
        .section-nav a:hover {
            text-decoration: underline;
        }

        .h3 {
            font-size: 2.3rem;
            color: #7b7b7b;
            margin-bottom: 1.5rem;
        }

        .h4 {
            font-size: 1.5rem;
            color: hsl(0, 0%, 46%);
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body>
    <main>
        <div class="container">
            <div class="tab-nav">
                <button class="tab-button active" id="about-tab" data-tab="about">About</button>
                <button class="tab-button" id="demo-tab" data-tab="demo">Explore Features</button>
            </div>

            <div id="about-content" class="tab-content active">
                <div class="about-content">
                    <div style="width: 100vw; margin-left: calc(-50vw + 50%); padding: 4rem 0; margin-bottom: 3rem;">
                        <div style="max-width: 1200px; margin: 0 auto; padding: 0 2rem;">
                            <h1 style="text-align: center; font-size: 3rem; font-weight: 700; color: #333; margin-bottom: 1rem;">
                                Interpretability for Neural TSP Solvers
                            </h1>
                            <p style="text-align: center; font-size: 1.2rem; color: #666; margin-bottom: 3rem; max-width: 800px; margin-left: auto; margin-right: auto;">
                                Investigating the latent space of a neural TSP solver using sparse autoencoders and linear probes.
                            </p>
                            
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; margin-top: 3rem;">
                                <!-- TSP Solver Panel -->
                                <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center; cursor: pointer; transition: transform 0.2s ease;" onclick="document.getElementById('tsp-solver').scrollIntoView()">
                                    <div style="width: 100%; height: 300px; background: #f8f9fa; border-radius: 8px; margin-bottom: 1.5rem; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                                        <img src="solution_demo.png" alt="TSP Solution Demo" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                                    </div>
                                    <h3 style="color: #000000; margin-bottom: 1rem; font-size: 1.5rem;">Neural TSP Solver</h3>
                                </div>
                                
                                <!-- Sparse Autoencoder Panel -->
                                <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center; cursor: pointer; transition: transform 0.2s ease;" onclick="document.getElementById('sparse-autoencoder').scrollIntoView()">
                                    <div style="width: 100%; height: 300px; background: #f8f9fa; border-radius: 8px; margin-bottom: 1.5rem; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                                        <img src="sae_demo.png" alt="SAE Demo" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                                    </div>
                                    <h3 style="color: #000000; margin-bottom: 1rem; font-size: 1.5rem;">Sparse Autoencoder</h3>
                                </div>
                                
                                <!-- Feature Analysis Panel -->
                                <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1); text-align: center; cursor: pointer; transition: transform 0.2s ease;" onclick="document.getElementById('feature-analysis').scrollIntoView()">
                                    <div style="width: 100%; height: 300px; background: #f8f9fa; border-radius: 8px; margin-bottom: 1.5rem; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                                        <img src="feature_demo.png" alt="Feature Analysis Demo" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                                    </div>
                                    <h3 style="color: #000000; margin-bottom: 1rem; font-size: 1.5rem;">Feature Analysis</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h2>Introduction</h2>
                    <div style='max-width: 800px; margin: 0 auto; line-height: 1.6; color: #000000;'>
                        <p>Sparse coding has garnered interest in the AI interpretability community for discovering features and circuits within the latent space of neural networks. While most of this interpretability work has focused on language models, the same techniques can be applied to other modalities. We are interested in applying these techniques on OR-solver models, starting with the TSP. Many recent efforts have used deep learning to either learn heuristics to solve or to directly solve the TSP.</p>
                        <br>
                        <p>By investigating the latent space of these models, we hope to:</p>
                        <ul>
                            <li>Learn details about the model itself, such as debugging and training dynamics</li>
                            <li>Identify motifs that could be externally useful to understanding the TSP domain</li>
                            <li>Extract other learned attributes of TSP instances for transfer learning</li>
                        </ul>
                        
                        <!-- TSP Solver Section -->
                        <div id="tsp-solver">
                            <h3>TSP Solver</h3>
                            <div>
                                <div class="section-nav">
                                    <a href="#architecture">Architecture</a> | 
                                    <a href="#data">Data</a> | 
                                    <a href="#training-method">Training Method</a>
                                </div>
                                
                                <h4 id="architecture" class="section-content-header">Architecture</h4>
                                <div style='text-align: center; margin: 2rem 0;'>
                                    <img src='architecture.png' alt='SAE Feature Analysis Architecture' style='width: 80%; max-width: none; height: auto; border: 0px solid #ddd; border-radius: 8px; margin-left: -5%;'>
                                    <p style='font-style: italic; margin-top: 0.5rem;'>System architecture showing the flow from TSP instances through the policy network to SAE feature extraction and analysis.</p>
                                </div>
                                
                                <p>We use (RL4CO)'s implementation of (Kool et al.)'s Transformer Pointer Network, which performs next-node prediction to autoregressively construct TSP solutions. We focus on TSP instances with a fixed size of 100 nodes.</p>

                                <h4 id="data" class="section-content-header">Data</h4>
                                <p>
                                Our TSP policy is trained on instances drawn from a configurable distribution. As a default, nodes are drawn uniformly over the unit square, but we also run experiments with more structured distributions, such as clustered Gaussians, concentric shapes (for example, points on a circle), latitude-longitude pairs from real road-network waypoints, and other custom generators. For consistency, the model is only evaluated on instance drawn from the same distribution as the training data.
                                </p>
                                
                                <div style="display: flex; gap: 1rem; justify-content: center; margin: 2rem 0; width: 100%;">
                                    <img src="" alt="Data Distribution Example 1" style="width: calc(33.33% - 0.67rem); aspect-ratio: 1; border: 1px solid #ddd; border-radius: 8px; object-fit: cover;">
                                    <img src="" alt="Data Distribution Example 2" style="width: calc(33.33% - 0.67rem); aspect-ratio: 1; border: 1px solid #ddd; border-radius: 8px; object-fit: cover;">
                                    <img src="" alt="Data Distribution Example 3" style="width: calc(33.33% - 0.67rem); aspect-ratio: 1; border: 1px solid #ddd; border-radius: 8px; object-fit: cover;">
                                </div>
                                
                                <p>
                                During training, we resample the instances every epoch. For most settings, we used 100,000 instances per epoch for 300 epochs, or 30M unique instances. Alongside the training instances, we freeze a separate validation environment that resamples the same instances at each validation step. We also solve those validation tours optimally with the Concorde solver, so that we can record our model's performance in terms of suboptimality throughout training.
                                </p>

                                
                                <h4 id="training-method" class="section-content-header">Training Method</h4>
                                <p>Due to the nature of the TSP, generating optimal solutions at scale for supervised learning is computationally intractable. Instead, we train our solver using reinforcement learning, following the work of (Joshi) allowing the model to learn directly from interaction with the environment rather than relying on supervised labels. Training is conducted using the REINFORCE algorithm with gradient clipping to ensure stable parameter updates. Specifically, we use the RL4CO library's PyTorch Lightning-based training framework, including their TSP environment implementation. The reward signal is the negative tour length, incentivizing the model to find shorter tours. Each training run begins with a warm-up phase consisting of 1,000 greedy rollouts, which helps initialize the baseline and stabilize early policy learning. Afterwards, node selection during rollouts is sampled from a temperature-controlled softmax distribution. Once REINFORCE produces gradeints, we update parameters with the Adam optimizer.</p>

                                <div style='text-align: center; margin: 2rem 0;'>
                                    <img src='animation_demo.gif' alt='Training Results Animation Demo' style='width: 80%; max-width: none; height: auto; border: 1px solid #ddd; border-radius: 8px;'>
                                    <p style='font-style: italic; margin-top: 0.5rem;'>Animation demonstrating the training progress and results.</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sparse Autoencoder Section -->
                        <div id="sparse-autoencoder">
                            <h3>Sparse Autoencoder</h3>
                            <div>
                                <h4 id="sae-background" class="section-content-header">SAE Background</h4>
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>

                                <h4 id="sae-training" class="section-content-header">SAE Training Details</h4>
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>

                                <h4 class="section-content-header">Current Analysis</h4>
                                <p><strong>Run:</strong> Hybrid_3_1e-5</p>
                                <p><strong>SAE Model:</strong> sae_l10.001_ef4.0_k0.1_03-21_17:41:07</p>
                                <p>This analysis includes data from multiple features with varying activation strengths, providing insights into the learned representations and their interpretability.</p>
                            </div>
                        </div>
                        
                        <!-- Feature Analysis Section -->
                        <div id="feature-analysis">
                            <h3>Feature Analysis</h3>
                            <div>
                                <h4 class="section-content-header">Features</h4>
                                <ul>
                                    <li><strong>Per Feature View:</strong> Explore individual features and their top activating instances</li>
                                    <li><strong>Per Instance View:</strong> Examine specific instances and see which features they activate</li>
                                    <li><strong>Interactive Visualization:</strong> Click on images to view them in full resolution</li>
                                    <li><strong>Activation Analysis:</strong> View activation strengths and patterns across different features</li>
                                </ul>
                                
                                <h4 id="feature-analysis-methodology" class="section-content-header">Feature Analysis</h4>
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>

                                <h4 id="feature-visualization" class="section-content-header">Feature Visualization</h4>
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>

                                <h4 id="discussion" class="section-content-header">Discussion</h4>
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>

                                <h4 class="section-content-header">How to Use</h4>
                                <p>Use the dropdown menu above to switch between different views:</p>
                                <ul>
                                    <li>Select "Per Feature" to explore individual features and their most activating instances</li>
                                    <li>Select "Per Instance" to examine specific instances and see which features they activate most strongly</li>
                                    <li>Click on any image to view it in full resolution in a new tab</li>
                                </ul>
                                
                                <p><em>This is placeholder content that will be expanded with a full article about the methodology, results, and implications of this SAE analysis.</em></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="demo-content" class="tab-content">
                <div class="feature-viewer">
                    <div class="feature-info">
                        <div class="info-row">
                            <div class="info-left">
                                <select id="feature-select" class="feature-title-select">
                                    <option value="409">Feature 409</option>
                                    <option value="941">Feature 941</option>
                                    <option value="894">Feature 894</option>
                                    <option value="227">Feature 227</option>
                                    <option value="945">Feature 945</option>
                                    <option value="1022">Feature 1022</option>
                                    <option value="348">Feature 348</option>
                                    <option value="874">Feature 874</option>
                                    <option value="762">Feature 762</option>
                                    <option value="764">Feature 764</option>
                                    <option value="239">Feature 239</option>
                                    <option value="951">Feature 951</option>
                                    <option value="374">Feature 374</option>
                                    <option value="898">Feature 898</option>
                                    <option value="50">Feature 50</option>
                                    <option value="323">Feature 323</option>
                                    <option value="82">Feature 82</option>
                                    <option value="948">Feature 948</option>
                                    <option value="978">Feature 978</option>
                                    <option value="272">Feature 272</option>
                                    <option value="770">Feature 770</option>
                                    <option value="555">Feature 555</option>
                                    <option value="730">Feature 730</option>
                                    <option value="329">Feature 329</option>
                                    <option value="689">Feature 689</option>
                                    <option value="287">Feature 287</option>
                                    <option value="310">Feature 310</option>
                                    <option value="243">Feature 243</option>
                                    <option value="710">Feature 710</option>
                                    <option value="63">Feature 63</option>
                                    <option value="596">Feature 596</option>
                                    <option value="76">Feature 76</option>
                                    <option value="501">Feature 501</option>
                                    <option value="787">Feature 787</option>
                                    <option value="210">Feature 210</option>
                                    <option value="829">Feature 829</option>
                                    <option value="836">Feature 836</option>
                                    <option value="616">Feature 616</option>
                                    <option value="376">Feature 376</option>
                                    <option value="443">Feature 443</option>
                                </select>
                            </div>
                            <div class="info-right">
                                <span class="config-label">Policy Config:</span> lr: 1e-05, epochs: 1000, embed_dim: 256, layers: 5, dropout: 0.1, temp: 1.0
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-left">
                                <p><strong>Average Activation:</strong> <span id="current-activation">1.4363</span></p>
                            </div>
                            <div class="info-right">
                                <span class="config-label">SAE Config:</span> lr: 0.001, epochs: 30, exp_factor: 4.0, k_ratio: 0.1, l1_coef: 0.001, batch_size: 64
                            </div>
                        </div>
                    </div>
                    
                    <div class="feature-overlay-container">
                        <img id="current-overlay" 
                             src="feature_overlays/feature_409_overlay.png"
                             alt="Feature Overlay" 
                             class="feature-overlay"
                             onclick="openImage('feature_overlays/feature_409_overlay.png')">
                    </div>
                    
                    <h3>Top Activating Instances</h3>
                    <div class="instances-grid" id="top-instances-grid">
                        <!-- Top instances will be populated by JavaScript -->
                    </div>
                    
                    <h3>Bottom Activating Instances</h3>
                    <div class="instances-grid" id="bottom-instances-grid">
                        <!-- Bottom instances will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 TSP Solver Mechanistic Interpretability</p>
        </div>
    </footer>

    <script src="assets/js/main.js"></script>
</body>
</html> 